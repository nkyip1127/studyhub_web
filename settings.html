<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHub - Settings</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-logo">
            <i data-lucide="graduation-cap" class="logo-icon" style="width: 28px; height: 28px;"></i>
            <span class="logo-text">StudyHub</span>
        </div>
        <div class="nav-menu">
            <a href="home.html" class="nav-link">
                <i data-lucide="house" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Home</span>
            </a>
            <a href="study-room.html" class="nav-link">
                <i data-lucide="users" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Study Room</span>
            </a>
            <a href="resource-hub.html" class="nav-link">
                <i data-lucide="book-open" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Resource Hub</span>
            </a>
            <a href="leaderboard.html" class="nav-link">
                <i data-lucide="award" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Leaderboard</span>
            </a>
            <a href="friends.html" class="nav-link">
                <i data-lucide="user-plus" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Friends</span>
            </a>
            <a href="settings.html" class="nav-link active">
                <i data-lucide="settings" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Settings</span>
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="settings-section">
            <h2>Profile Settings</h2>
            <div class="settings-form">
                <div class="profile-picture-section">
                    <div class="profile-picture-display">
                        <div class="profile-picture-icon" id="profilePictureIcon">JD</div>
                        <img src="" alt="Profile" class="profile-preview" id="profilePreview" style="display: none;">
                    </div>
                    <div class="profile-picture-upload">
                        <button type="button" class="change-icon-btn" onclick="triggerFileInput()">
                            <i data-lucide="camera" style="width: 18px; height: 18px; margin-right: 8px; display: inline-block; vertical-align: middle;"></i>
                            <span>Change Icon</span>
                        </button>
                        <button type="button" class="reset-icon-btn" onclick="resetProfileIcon()" style="margin-top: 10px; background-color: #666; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: 500; min-width: 200px; height: 44px;">
                            Reset to Default
                        </button>
                        <input type="file" id="profilePicture" accept="image/*" onchange="updateProfileIcon(this)" style="display: none;">
                    </div>
                </div>
                <div class="form-group">
                    <label for="settingsUsername">Username</label>
                    <input type="text" id="settingsUsername" value="">
                </div>
                <button class="submit-btn" onclick="saveProfile()">Save Changes</button>
            </div>
        </div>

        <div class="settings-section">
            <h2>Email Settings</h2>
            <div class="settings-form">
                <div class="form-group">
                    <label for="currentEmail">Enter Current Email</label>
                    <input type="email" id="currentEmail" value="">
                </div>
                <div class="form-group">
                    <label for="newEmail">Enter New Email</label>
                    <input type="email" id="newEmail">
                </div>
                <div class="form-group">
                    <label for="confirmEmail">Confirm New Email</label>
                    <input type="email" id="confirmEmail">
                </div>
                <button class="submit-btn" onclick="saveEmail()">Save Changes</button>
            </div>
        </div>

        <div class="settings-section">
            <h2>Password Settings</h2>
            <div class="settings-form">
                <div class="form-group">
                    <label for="currentPassword">Enter Current Password</label>
                    <input type="password" id="currentPassword">
                </div>
                <div class="form-group">
                    <label for="newPassword">Enter New Password</label>
                    <input type="password" id="newPassword">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" id="confirmPassword">
                </div>
                <button class="submit-btn" onclick="savePassword()">Save Changes</button>
            </div>
        </div>

        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div id="notification" class="notification"></div>
    <script src="app.js"></script>
    <script>
        // Make label clickable - use onclick to avoid multiple event listeners
        function triggerFileInput() {
            const fileInput = document.getElementById('profilePicture');
            if (fileInput) {
                fileInput.click();
            }
        }
        
        window.onload = function() {
            // Load saved username from localStorage
            const savedUsername = localStorage.getItem('currentUsername');
            const usernameInput = document.getElementById('settingsUsername');
            if (usernameInput) {
                if (savedUsername) {
                    usernameInput.value = savedUsername;
                } else if (typeof currentUser !== 'undefined') {
                    usernameInput.value = currentUser.username;
                } else {
                    usernameInput.value = 'John Doe';
                }
            }
            
            // Load saved email from localStorage (sign up email or default)
            const savedEmail = localStorage.getItem('currentUserEmail');
            const currentEmailInput = document.getElementById('currentEmail');
            if (currentEmailInput) {
                if (savedEmail) {
                    currentEmailInput.value = savedEmail;
                } else {
                    currentEmailInput.value = 'john.doe@example.com';
                }
            }
            
            // Set default profile icon to user abbreviation
            if (typeof currentUser !== 'undefined' && typeof getUserIconAbbreviation === 'function') {
                const iconEl = document.getElementById('profilePictureIcon');
                if (iconEl) {
                    const displayUsername = savedUsername || currentUser.username;
                    iconEl.textContent = getUserIconAbbreviation(displayUsername);
                }
            }
            // Initialize lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        };
    </script>
</body>
</html>

