<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHub - Resource Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-logo">
            <i data-lucide="graduation-cap" class="logo-icon" style="width: 28px; height: 28px;"></i>
            <span class="logo-text">StudyHub</span>
        </div>
        <div class="nav-menu">
            <a href="home.html" class="nav-link">
                <i data-lucide="house" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Home</span>
            </a>
            <a href="study-room.html" class="nav-link">
                <i data-lucide="users" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Study Room</span>
            </a>
            <a href="resource-hub.html" class="nav-link active">
                <i data-lucide="book-open" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Resource Hub</span>
            </a>
            <a href="leaderboard.html" class="nav-link">
                <i data-lucide="award" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Leaderboard</span>
            </a>
            <a href="friends.html" class="nav-link">
                <i data-lucide="user-plus" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Friends</span>
            </a>
            <a href="settings.html" class="nav-link">
                <i data-lucide="settings" class="nav-icon" style="width: 18px; height: 18px;"></i>
                <span>Settings</span>
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="study-points-banner" style="background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">Your Study Points</div>
            <div style="font-size: 32px; font-weight: 700;" id="resourceHubStudyPoints">100</div>
        </div>
        <div class="upload-section">
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="create-btn" onclick="uploadResource()">Upload Resources</button>
                <button class="rules-btn" onclick="showPointRules()">Study Point Rules in Resource Hub</button>
            </div>
        </div>

        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="resourceUniversity">University</label>
                    <select id="resourceUniversity">
                        <option value="">All Universities</option>
                        <option value="City University of Hong Kong">City University of Hong Kong</option>
                        <option value="Hong Kong Baptist University">Hong Kong Baptist University</option>
                        <option value="Lingnan University">Lingnan University</option>
                        <option value="The Chinese University of Hong Kong">The Chinese University of Hong Kong</option>
                        <option value="The Education University of Hong Kong">The Education University of Hong Kong</option>
                        <option value="The Hong Kong Polytechnic University">The Hong Kong Polytechnic University</option>
                        <option value="The Hong Kong University of Science and Technology">The Hong Kong University of Science and Technology</option>
                        <option value="The University of Hong Kong">The University of Hong Kong</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="resourceCourseCode">Course Code</label>
                    <input type="text" id="resourceCourseCode" placeholder="e.g. EE4213">
                </div>
                <div class="filter-group" style="display: flex; align-items: flex-end;">
                    <button class="search-btn" onclick="searchResources()">Search</button>
                </div>
            </div>
        </div>

        <div id="resourcesContainer" class="resources-grid"></div>
        <div id="resourcesPagination" class="pagination"></div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload Resource</h2>
                <button class="close-btn" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="modal-form">
                <div class="form-group">
                    <label for="uploadUniversity">University</label>
                    <select id="uploadUniversity" required>
                        <option value="">Select University</option>
                        <option value="City University of Hong Kong">City University of Hong Kong</option>
                        <option value="Hong Kong Baptist University">Hong Kong Baptist University</option>
                        <option value="Lingnan University">Lingnan University</option>
                        <option value="The Chinese University of Hong Kong">The Chinese University of Hong Kong</option>
                        <option value="The Education University of Hong Kong">The Education University of Hong Kong</option>
                        <option value="The Hong Kong Polytechnic University">The Hong Kong Polytechnic University</option>
                        <option value="The Hong Kong University of Science and Technology">The Hong Kong University of Science and Technology</option>
                        <option value="The University of Hong Kong">The University of Hong Kong</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="uploadCourseCode">Course Code</label>
                    <input type="text" id="uploadCourseCode" placeholder="e.g. EE4213" required>
                </div>
                <div class="form-group">
                    <label for="uploadDescription">Description</label>
                    <input type="text" id="uploadDescription" placeholder="e.g. This resource provides the solution of hw1 in sem A 2024." required>
                </div>
                <div class="form-group">
                    <label for="uploadType">Type</label>
                    <select id="uploadType" required onchange="toggleSolutionCheckbox()">
                        <option value="">Select Type</option>
                        <option value="Lab Report">Lab Report/Tutorial</option>
                        <option value="Lecture Notes">Lecture Notes</option>
                        <option value="Past Papers">Past Papers</option>
                        <option value="Homework">Homework/Assignment</option>
                        <option value="Others">Others</option>
                    </select>
                </div>
                <div class="form-group" id="solutionCheckboxGroup">
                    <label>
                        <input type="checkbox" id="uploadSolution"> Solution Available
                    </label>
                </div>
                <div class="form-group">
                    <label>Upload Document</label>
                    <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                        <p>Click to upload or drag and drop (Multiple files allowed)</p>
                        <input type="file" id="fileInput" multiple style="display: none;" onchange="showUploadedFiles(this)">
                    </div>
                    <div id="uploadedFilesList" style="margin-top: 10px;"></div>
                </div>
                <button class="submit-btn" onclick="submitUpload()">Upload</button>
            </div>
        </div>
    </div>

    <!-- Rules Modal -->
    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Study Point Rules in Resource Hub</h2>
                <button class="close-btn" onclick="closeRulesModal()">&times;</button>
            </div>
            <div class="rules-content">
                <div class="rules-section">
                    <div class="rules-section-header">
                        <i data-lucide="upload" class="rules-icon" style="width: 24px; height: 24px;"></i>
                        <h3>Upload</h3>
                    </div>
                    <div class="rules-list">
                        <div class="rule-item upload-rule">
                            <div class="rule-type">Past Paper</div>
                            <div class="rule-details">
                                <span class="rule-points positive">+300 pts</span>
                                <span class="rule-note">* with solution: +100 more pts</span>
                            </div>
                        </div>
                        <div class="rule-item upload-rule">
                            <div class="rule-type">Homework/Assignment</div>
                            <div class="rule-details">
                                <span class="rule-points positive">+200 pts</span>
                                <span class="rule-note">* with solution: +100 more pts</span>
                            </div>
                        </div>
                        <div class="rule-item upload-rule">
                            <div class="rule-type">Lab Report/Tutorial</div>
                            <div class="rule-details">
                                <span class="rule-points positive">+150 pts</span>
                                <span class="rule-note">* with solution: +100 more pts</span>
                            </div>
                        </div>
                        <div class="rule-item upload-rule">
                            <div class="rule-type">Lecture Notes</div>
                            <div class="rule-details">
                                <span class="rule-points positive">+100 pts</span>
                            </div>
                        </div>
                        <div class="rule-item upload-rule">
                            <div class="rule-type">Others</div>
                            <div class="rule-details">
                                <span class="rule-points positive">+50 pts</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rules-section">
                    <div class="rules-section-header">
                        <i data-lucide="unlock" class="rules-icon" style="width: 24px; height: 24px;"></i>
                        <h3>Unlock</h3>
                    </div>
                    <div class="rules-list">
                        <div class="rule-item unlock-rule">
                            <div class="rule-type">Past Paper</div>
                            <div class="rule-details">
                                <span class="rule-points negative">-300 pts</span>
                                <span class="rule-note">* with solution: -100 more pts</span>
                            </div>
                        </div>
                        <div class="rule-item unlock-rule">
                            <div class="rule-type">Homework/Assignment</div>
                            <div class="rule-details">
                                <span class="rule-points negative">-200 pts</span>
                                <span class="rule-note">* with solution: -100 more pts</span>
                            </div>
                        </div>
                        <div class="rule-item unlock-rule">
                            <div class="rule-type">Lab Report/Tutorial</div>
                            <div class="rule-details">
                                <span class="rule-points negative">-150 pts</span>
                                <span class="rule-note">* with solution: -100 more pts</span>
                            </div>
                        </div>
                        <div class="rule-item unlock-rule">
                            <div class="rule-type">Lecture Notes</div>
                            <div class="rule-details">
                                <span class="rule-points negative">-100 pts</span>
                            </div>
                        </div>
                        <div class="rule-item unlock-rule">
                            <div class="rule-type">Others</div>
                            <div class="rule-details">
                                <span class="rule-points negative">-50 pts</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>
    <script src="app.js"></script>
    <script>
        // Store selected files (make it globally accessible)
        window.selectedFiles = [];
        
        function showUploadedFiles(input) {
            const filesListDiv = document.getElementById('uploadedFilesList');
            if (!filesListDiv) return;
            
            // Add new files to selectedFiles array
            if (input.files && input.files.length > 0) {
                Array.from(input.files).forEach(file => {
                    // Check if file is already in the list
                    if (!window.selectedFiles.find(f => f.name === file.name && f.size === file.size && f.lastModified === file.lastModified)) {
                        window.selectedFiles.push(file);
                    }
                });
            }
            
            // Update the file input to reflect all selected files
            updateFileInput();
            displaySelectedFiles();
        }
        
        window.removeFile = function(index) {
            window.selectedFiles.splice(index, 1);
            updateFileInput();
            displaySelectedFiles();
        }
        
        function updateFileInput() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput) return;
            
            // Create a new DataTransfer object to set files
            const dataTransfer = new DataTransfer();
            window.selectedFiles.forEach(file => {
                dataTransfer.items.add(file);
            });
            fileInput.files = dataTransfer.files;
        }
        
        function displaySelectedFiles() {
            const filesListDiv = document.getElementById('uploadedFilesList');
            if (!filesListDiv) return;
            
            if (window.selectedFiles.length === 0) {
                filesListDiv.innerHTML = '';
                return;
            }
            
            filesListDiv.innerHTML = '<div style="font-weight: 500; margin-bottom: 8px; color: #1565C0;">Selected Files:</div>';
            window.selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background-color: #f5f5f5; border-radius: 5px; margin-bottom: 5px;';
                fileItem.innerHTML = `
                    <span style="flex: 1; color: #333; font-size: 14px;">${file.name}</span>
                    <button type="button" onclick="removeFile(${index})" style="background-color: #f44336; color: white; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;">Remove</button>
                `;
                filesListDiv.appendChild(fileItem);
            });
        }
        
        function toggleSolutionCheckbox() {
            const typeSelect = document.getElementById('uploadType');
            const solutionGroup = document.getElementById('solutionCheckboxGroup');
            if (typeSelect.value === 'Lecture Notes' || typeSelect.value === 'Others') {
                solutionGroup.style.display = 'none';
                document.getElementById('uploadSolution').checked = false;
            } else {
                solutionGroup.style.display = 'block';
            }
        }
        
        window.onload = function() {
            // Ensure data is initialized
            if (typeof initMockData === 'function') {
                initMockData();
            }
            
            // Update study points display
            if (typeof updateResourceHubStudyPoints === 'function') {
                updateResourceHubStudyPoints();
            } else if (typeof currentUser !== 'undefined') {
                const resourceHubPoints = document.getElementById('resourceHubStudyPoints');
                if (resourceHubPoints) {
                    resourceHubPoints.textContent = currentUser.studyPoints.toLocaleString();
                }
            }
            // Initialize lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            if (typeof displayResources === 'function') {
                displayResources();
            }
            
            // Re-initialize lucide icons when rules modal is opened
            const rulesModal = document.getElementById('rulesModal');
            if (rulesModal && typeof MutationObserver !== 'undefined') {
                const observer = new MutationObserver(function(mutations) {
                    if (rulesModal.style.display === 'block') {
                        if (typeof lucide !== 'undefined') {
                            setTimeout(() => {
                                lucide.createIcons();
                            }, 50);
                        }
                    }
                });
                observer.observe(rulesModal, { attributes: true, attributeFilter: ['style'] });
            }
        };
        
        window.onclick = function(event) {
            const uploadModal = document.getElementById('uploadModal');
            const rulesModal = document.getElementById('rulesModal');
            if (event.target === uploadModal) {
                closeUploadModal();
            }
            if (event.target === rulesModal) {
                closeRulesModal();
            }
        }
    </script>
</body>
</html>

